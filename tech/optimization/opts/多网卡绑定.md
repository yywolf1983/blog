Linux双网卡绑定一个IP实现教程

ip ro ls ip就是ip命令啦,ro就是route的所写,ls是list的缩写...
route -n


由于客户机比较多我们可以做到二块网卡同时工作。开始做了。


rh el 5测试通过。。


网卡1为eth0 网卡2为eth1 (这个大家都知道)


1.先修改eth0 和eht1这2个网卡配置文件.目录在(/etc/sysconfig/network-scripts/)如下：
DEVICE=eth0
ERCTL=no
ONBOOT=yes
MASTER=bond0
SLAVE=yes
BOOTPROTO=none


2. eth1 也是同样的修改.


3.新建一个虚拟网卡bond0,我们可以复制eth0的,复制后要修改内容.


复制 (cp /etc/sysconfig/network-scripts/ifcfg-eth0 ifcfg-bond0)修改内容为如下：


DEVICE=bond0


ONBOOT=yes


BOOTPROTO=static


IPADDR=192.168.0.227


NETMASK=255.255.255.0


BROADCAST=192.168.0.255


TYPE=Ethernet


4.修改/etc/modprobe.conf,添加内容如下：


/etc/modprobe.d/modprobe.conf


alias bond0 bonding


options bond0 miimon=100 mode=1


注意：mode可以为0, 1,      0为负载均衡,1为失效保护, 我们只用到0


关于：modprobe.conf文件在AS版本里面有，Linux9.0的是这个modules.conf文件


5:修改/etc/rc.d/rc.local,添加内容如下：


ifenslave bond0 eth0 eth1


route add -net 192.168.0.255 netmask 255.255.255.0 bond0




ifenslave bond0 eth0 eth1
modprobe bonding mode=6 miimon=100


=0： (balance-rr) Round-robin policy: （平衡抡循环策略）：传输数据包顺序是依次传输，直到最后一个传输完毕， 此模式提供负载平衡和容错能力。
=1： (active-backup) Active-backup policy:（主-备份策略）：只有一个设备处于活动状态。 一个宕掉另一个马上由备份转换为主设备。mac地址是外部可见得。 此模式提供了容错能力
=2：(balance-xor) XOR policy:（广播策略）：将所有数据包传输给所有接口。 此模式提供了容错能力。
=3：(balance-xor) XOR policy:（平衡策略）： 传输根据原地址布尔值选择传输设备。 此模式提供负载平衡和容错能力。
=4：(802.3ad) IEEE 802.3ad Dynamic link aggregation.IEEE 802.3ad 动态链接聚合：创建共享相同的速度和双工设置的聚合组。
=5：(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡）:没有特殊策略，第一个设备传不通就用另一个设备接管第一个设备正在处理的mac地址，帮助上一个传。
=6：(balance-alb) Adaptive load balancing:（适配器传输负载均衡）：大致意思是包括mode5，bonding驱动程序截获 ARP 在本地系统发送出的请求，用其中之一的硬件地址覆盖从属设备的原地址。就像是在服务器上不同的人使用不同的硬件地址一样。


完成。。。。。。。。。。。


mode=0 表示负载均衡方式，两块网卡都工作，需要交换机作支持。
mode=1 表示冗余方式，网卡只有一个工作，一个出问题启用另外的。
mode=6 表示负载均衡方式，两块网卡都工作，不需要交换机作支持。


查看：


[root@LMsev ~]# cat /proc/net/bonding/bond0


Ethernet Channel Bonding Driver: v3.0.3 (March 23, 2006)


Bonding Mode: fault-tolerance (active-backup)


Primary Slave: None


Currently Active Slave: eth0


MII Status: up


MII Polling Interval (ms): 100


Up Delay (ms): 0


Down Delay (ms): 0


Slave Interface: eth0


MII Status: up


Link Failure Count: 0


Permanent HW addr: 00:0c:29:ea:73:0f


Slave Interface: eth1


MII Status: up


Link Failure Count: 0


Permanent HW addr: 00:0c:29:ea:73:19
