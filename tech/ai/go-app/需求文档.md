# 围棋打谱应用需求文档

## 一、核心需求

### 1. 功能需求
- **SGF文件处理**：支持标准SGF格式的解析、保存和多分支管理
- **游戏导航**：实现"下一步"、"上一步"、"到起始"等导航功能
- **座子显示**：确保让子棋子在走子过程中保持显示
- **分支管理**：支持分支的创建、切换和预览（幽灵棋子）

### 2. 技术需求
- **代码稳定性**：确保应用编译通过，无运行时错误
- **文档同步**：实现代码变更与文档的自动同步
- **算法优化**：优化SGF解析算法，提升加载速度和稳定性

### 3. AI文档管理需求
- **自动文档更新**：AI能根据代码变更自动更新对应md文件
- **文档关联规则**：明确不同md文件的职责边界和触发条件
- **流程自动化**：建立从代码变更到文档更新的完整流程

## 二、现有md文件分析

### 1. 文件职责边界

| **文件名称**       | **核心职责**                          | **关联模块**                              |
|--------------------|--------------------------------------|-------------------------------------------|
| `README.md`        | 项目概述、功能介绍、使用指南           | 全项目（功能变更、API修改、构建流程）      |
| `bugfix.md`        | 记录bug修复过程、原因及解决方案       | 错误处理、代码修复、运行时问题            |
| `sgf算法.md`       | SGF解析算法的详细分析与实现说明        | SGFConverter.java、SGFParser.java         |

### 2. 文件间相关性

- **`README.md` ↔ `bugfix.md`**：
  - 前者记录已解决问题的摘要，后者记录详细修复过程
  - 前者面向用户/开发者，后者面向维护者/调试人员

- **`README.md` ↔ `sgf算法.md`**：
  - 前者记录SGF功能的使用说明，后者记录算法实现细节
  - 前者关注功能，后者关注技术实现

- **`bugfix.md` ↔ `sgf算法.md`**：
  - 当SGF解析算法出现bug时，两者需同步更新
  - 前者记录修复过程，后者记录算法优化点

## 三、AI文档管理机制

### 1. 触发条件与关联规则

| **操作类型**       | **触发条件**                          | **需更新的md文件**                |
|--------------------|--------------------------------------|-----------------------------------|
| **Bug修复**        | 1. 代码提交包含 `[BUGFIX]` 标签<br>2. 修复运行时/编译错误 | `bugfix.md`、`README.md`          |
| **功能新增**        | 1. 代码提交包含 `[FEATURE]` 标签<br>2. 添加新模块/API | `README.md`                       |
| **算法优化**        | 1. 修改SGF解析逻辑<br>2. 提升算法性能 | `sgf算法.md`、`README.md`          |
| **文档结构调整**    | 1. 新增md文件<br>2. 修改文档模板 | 所有相关md文件                    |

### 2. 自动化流程设计

#### 流程1：代码变更触发文档更新
1. **代码提交**：开发者提交代码，包含标签（如 `[BUGFIX]`）
2. **AI检测**：AI监控提交信息和变更文件路径
3. **文档匹配**：根据变更类型和文件路径匹配对应md文件
4. **内容生成**：AI分析代码变更，生成文档更新内容
5. **写入文档**：将生成内容写入对应md文件的适当位置

#### 流程2：用户指令触发文档更新
1. **用户指令**：用户直接要求更新文档（如"记录此修复到bugfix.md"）
2. **AI分析**：AI解析指令，确定目标文档和内容需求
3. **信息收集**：AI收集相关代码变更或问题描述
4. **文档更新**：AI生成并写入文档内容

### 3. 实现技术方案

- **Git钩子集成**：在 `post-commit` 钩子中添加文档更新逻辑
- **代码注释标记**：使用 `TODO-DOC` 注释指示需要更新的文档
- **文件路径映射**：建立代码文件与md文件的映射关系表
- **CI/CD流程**：在构建过程中检查并更新文档

## 四、验证与测试

### 1. 功能验证
- **SGF文件加载**：验证能正确加载并显示走子记录
- **导航功能**：验证"下一步"、"上一步"等功能正常
- **座子显示**：验证让子棋子在走子过程中不消失
- **分支管理**：验证分支创建和预览功能正常

### 2. 文档验证
- **一致性检查**：代码变更后，对应md文件是否自动更新
- **完整性检查**：文档内容是否完整覆盖功能点
- **格式检查**：文档格式是否规范、易读

### 3. AI文档管理验证
- **触发测试**：提交带标签的代码，验证AI是否自动更新文档
- **关联测试**：修改不同模块，验证AI是否匹配正确的md文件
- **边界测试**：测试特殊情况（如无标签提交）的处理逻辑

## 五、项目文件结构与md文件关联

```
/项目根目录
├── go-record-app/                # 应用主目录
│   ├── app/src/main/java/        # 源码目录
│   │   ├── model/GoBoard.java    # 棋盘逻辑（关联 bugfix.md）
│   │   ├── util/                 # 工具类目录
│   │   │   ├── SGFConverter.java # SGF转换（关联 sgf算法.md、bugfix.md）
│   │   │   ├── SGFParser.java    # SGF解析（关联 sgf算法.md）
│   │   ├── view/BoardView.java   # 棋盘视图（关联 README.md）
│   │   ├── MainActivity.java     # 主界面（关联 README.md）
├── README.md                     # 项目说明（总览）
├── bugfix.md                     # 修复记录（问题详情）
├── sgf算法.md                    # 算法分析（技术实现）
├── 需求文档.md                    # 核心需求（本文件）
```

## 六、结论与下一步计划

### 1. 结论
- 本需求文档明确了应用的核心功能目标和技术要求
- 建立了AI自动管理md文档的完整机制
- 分析了现有md文件的相关性，确保文档体系的一致性

### 2. 下一步计划
1. **代码修复**：完成"无法正常加载下一步"等问题的修复
2. **文档同步**：实现代码变更与md文件的自动同步
3. **功能验证**：测试所有核心功能是否正常运行
4. **文档审核**：确保所有md文件内容完整、格式规范
